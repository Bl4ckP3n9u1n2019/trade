# trade.accumulator


## trade.accumulator.Accumulator
An accumulator of quantity @ some average price.

### Attributes:
+ asset: An asset instance, the asset whose data are being accumulated.
+ date: A string 'YYYY-mm-dd' representing the date of the last status change of the accumulator.
+ quantity: The asset's accumulated quantity.
+ price: The asset's average price for the quantity accumulated.
+ results: A dict with the total results from the operations accumulated.
+ logging: A boolean indicating if the accumulator should log the calls to the accumulate() method.
+ log: A dict with all the operations performed with the asset, provided that self.logging is True.

if created with logging=True the accumulator will log the
data and the results of every operation it accumulate.

Results are calculated by the accumulator according to the value
of the operations informed and the current status of the
accumulator (the current quantity and average price of the asset).

The method accumulate() can take a optional param 'results', a dict
with other results to be included in the accumulator results dict
and on the operation log.

### Methods:

#### init (self, asset, initial_status=None, logging=False):
Creates a instance of the accumulator.

A initial status (quantity, average price and results) can be
informed by passing a initial_status param like this:
```python
    initial_status = {
        'date': 'YYYY-mm-dd'
        'quantity': float
        'price': float
        'results': {
            'result name': float,
            ...
        }
    }
```
The logging param is by default set to False; the accumulator
will not log any operation, just accumulate the quantity and
calculate the average price and results related to the asset
after each call to accumulate().

If logging is set to True the accumulator will log the data
passed on every call to accumulate(), as well as any
results generated by the accumulation.


#### log_operation(self, quantity, price, date, results):
Log operation data.

If logging, this method is called behind the scenes every
time the method accumulate() is called. The operations are
logged like this:
```python
    self.log = {
        '2017-09-19': {
            'position': {
                'quantity': float
                'price': float
            }
            'operations': [
                {
                    'quantity': float,
                    'price': float,
                    'results': {
                        'result name': float
                    }
                },
                ...
            ],
        },
        ...
    }
```
#### accumulate(self, quantity, price, date=None, results=None):
Accumulates operation data to the existing position.

The method accumulate() can take a optional param 'results',
a dict with other results to be included on the accumulator
results dict.

You may have a result related to this stock, but not a change
in position. In this case you would call the accumulate()
method like this:
```python
    accumulator.accumulate(
        date='2015-09-19',
        results={
            'daytrade': 100
        }
    )
```
The result dict passed to this method must obey the format:
```python
    results = {
        'result name': float
    }
```
The accumulator takes care of adding the custom results to the
total results of the stock. The custom results will also be
logged, if logging.


#### accumulate_operation(self, operation):
Interface to accumulate() that accepts an Operation object.

#### accumulate_daytrade(self, daytrade):
Interface to accumulate() that accepts a Daytrade object.

#### accumulate_event(self, event):
Receives a Event subclass instance and lets it do its work.

An event can change the quantity, price and results stored in
the accumulator.

The way it changes this information is up to the event object;
each Event subclass must implement a method like this:
```python
    update_portfolio(quantity, price, results)
        # do stuff here...
        return quantity, price
```
that have the logic for the change in the accumulator's
quantity, price and results.

#### log_event(self, event):
Log event data.

If logging, this method is called behind the scenes every
time the method accumulate_event() is called. The events are
logged like this:
```python
    self.log = {
        '2017-09-19': {
            'position': {
                'quantity': float
                'price': float
            }
            'events': [
                {
                    'name': string,
                    'other event attr': event_attr_value
                    ...
                },
                ...
            ],
        },
        ...
    }
```
Where every attribute of the event object will be logged.


## trade.accumulator.Event
A portfolio-changing event.

Events can change the quantity, the price and the results stored in
the accumulator. This is a base class for Events; every event must
inherit from this class and have a method like this:
```python
    update_portfolio(quantity, price, results)
        # do stuff here...
        return quantity, price
```
that implements the logic for the change in the portfolio.



Copyright (c) 2015 Rafael da Silva Rocha  
rocha.rafaelsilva@gmail.com  
http://github.com/rochars/trade  
http://trade.readthedocs.org  
